<template>
    <div>
        <div class="toggle-container0" :style="{  backgroundColor: defaultBgc}" @click="toggle" ref="bg" v-if="!opened">
            <div class="toggle-ball0" ref="ball" ></div>
        </div>
        <div class="toggle-container1" :style="{  backgroundColor: checkedtBgc}" @click="toggle" ref="bg" v-if="opened">
            <div class="toggle-ball1" ref="ball" ></div>
        </div>

        <lc-dialog :type="type"
                :title="title"
                :confirm-text="confirmText"
                :cancel-text="cancelText"
                :show="show"   
                @LcDialogCancelBtnClicked="dialogCancelBtnClick"         
                @LcDialogConfirmBtnClicked="dialogConfirmBtnClick"></lc-dialog>
    </div>
</template>

<style scoped>
    .toggle-container0{
        width: 100px;
        height: 50px;
        border-radius: 25px;
        position: relative;
        flex-direction: row;
        align-items: center;
    }
    .toggle-container1{
        width: 100px;
        height: 50px;
        border-radius: 25px;
        position: relative;
        flex-direction: row;
        align-items: center;
    }
    .toggle-ball0{
        width: 46px;
        height: 46px;
        border-radius: 46px;
        margin-left: 5px;
        background-color: #ffffff;
    }
    .toggle-ball1{
        width: 46px;
        height: 46px;
        border-radius: 46px;
        margin-left: 50px;
        background-color: #ffffff;
    }
</style>

<script>
    const animation = weex.requireModule('animation');
    var modal = weex.requireModule('modal');
    import LcDialog from '../lc-dialog';

    export default {
        // name: "toggle",
        components: { LcDialog },
        props: {
            opened: {
                default: true
            },
            autoSwitch:{
                default: true
            },
            width: {
                type: [Number, String],
                default: 100
            },
            defaultBgc:{
                default: '#cccccc'
            },
            checkedtBgc:{
                default: '#3580ed'
            },

            title: {
                type: [String],
                default: '确定吗？'
            },
            confirmText: {
                type: [String],
                default: '确定'
            },
            cancelText: {
                type: [String],
                default: '取消'
            },
        },
        data(){
            return {
                isOpened: this.opened,

                type: 'confirm',
                show: false,
            }
        },
        watch:{
            opened(val){
                this.isOpened=val;
            }
        },
        methods:{
            open0(){
                var el = this.$refs.ball;
                var bg = this.$refs.bg;
                animation.transition(el, {
                        styles: {
                            transform: 'translate(48px, 0px)',
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
                animation.transition(bg, {
                        styles: {
                            backgroundColor: this.checkedtBgc,
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
            },
            close0(){
                var el = this.$refs.ball;
                var bg = this.$refs.bg;
                animation.transition(el, {
                        styles: {
                            transform: 'translate(-2px, 0px)',
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
                animation.transition(bg, {
                        styles: {
                            backgroundColor: this.defaultBgc,
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
            },
            open1(){
                var el = this.$refs.ball;
                var bg = this.$refs.bg;
                animation.transition(el, {
                        styles: {
                            transform: 'translate(-2px, 0px)',
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
                animation.transition(bg, {
                        styles: {
                            backgroundColor: this.checkedtBgc,
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
            },
            close1(){
                var el = this.$refs.ball;
                var bg = this.$refs.bg;
                animation.transition(el, {
                        styles: {
                            transform: 'translate(-48px, 0px)',
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
                animation.transition(bg, {
                        styles: {
                            backgroundColor: this.defaultBgc,
                        },
                        duration: 300,
                        timingFunction: 'ease',
                        delay: 0 
                    }, function () {}
                )
            },
            toggle(){
                var that = this;
                if(!this.autoSwitch){
                    that.show=true;
                }else{
                    if(!that.opened){
                        if(that.isOpened){
                            that.close0();
                        }else{
                            that.open0();
                        }
                    }else{
                        if(that.isOpened){
                            that.close1();
                        }else{
                            that.open1();
                        }
                    }
                    this.isOpened = !this.isOpened;
                    this.$emit('toggle', this.isOpened);
                }

            },
            dialogConfirmBtnClick(){
                var that = this;
                if(!that.opened){
                    if(that.isOpened){
                        that.close0();
                    }else{
                        that.open0();
                    }
                }else{
                    if(that.isOpened){
                        that.close1();
                    }else{
                        that.open1();
                    }
                }
                that.isOpened = !that.isOpened;                            
                that.$emit('toggle', that.isOpened);
                this.show=false;
            },
            dialogCancelBtnClick(){
                this.show=false;
            }

        }
    };
</script>
